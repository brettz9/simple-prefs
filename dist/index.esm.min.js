function e(e,t,s){return s?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function t(e,t,s){try{var r=Promise.resolve(e());return t?r.then(t):r}catch(e){return Promise.reject(e)}}class s{constructor(e){this.configurePrefs(e),this.listeners=[]}configurePrefs(e){let{namespace:t,defaults:s,prefDefaults:r=n(s)}=e;this.namespace=t??"",this.prefDefaults=r}getPref(s){const r=this;return t((function(){const t=localStorage.getItem(r.namespace+s);return e(e(null===t?r.prefDefaults.getPrefDefault(s):JSON.parse(t),void 0,!(null===t)))}))}setPref(s,r){const n=this;return t((function(){return e(localStorage.setItem(n.namespace+s,JSON.stringify(r)))}))}bind(){return{getPref:this.getPref.bind(this),setPref:this.setPref.bind(this)}}listen(e,t){"function"==typeof e&&(t=e,e=void 0);const s=s=>{if(null===s.key){if(void 0===e)return}else{if(!s.key.startsWith(this.namespace))return;if(void 0!==e&&!s.key.startsWith(this.namespace+e))return}t(s)};return window.addEventListener("storage",s),this.listeners.push(s),s}unlisten(e){if(e)for(let t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return this.listeners.splice(t,1),void window.removeEventListener("storage",e);this.listeners.forEach((e=>{window.removeEventListener("storage",e)}))}}class r{constructor(e){let{defaults:t}=e;this.defaults=t}getPrefDefault(s){const r=this;return t((function(){return e(r.defaults[s],(function(e){return e??null}))}))}setPrefDefault(s,r){const n=this;return t((function(){const t=n.defaults[s]??null;return n.defaults[s]=r,e(t)}))}}function n(){return new r({defaults:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}})}export{s as SimplePrefs,r as SimplePrefsDefaults,n as simplePrefsDefaults};
//# sourceMappingURL=index.esm.min.js.map
