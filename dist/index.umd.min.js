!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SimplePrefs={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var s=function(){function e(n){t(this,e),this.configurePrefs(n),this.listeners=[]}return r(e,[{key:"configurePrefs",value:function(e){var t=e.namespace,n=e.defaults,r=e.prefDefaults,i=void 0===r?u(n):r;Object.assign(this,{namespace:t,prefDefaults:i})}},{key:"getPref",value:function(e){try{var t=localStorage.getItem(this.namespace+e);return i(null===t?this.prefDefaults.getPrefDefault(e):JSON.parse(t),void 0,!(null===t))}catch(e){return Promise.reject(e)}}},{key:"setPref",value:function(e,t){try{return i(localStorage.setItem(this.namespace+e,JSON.stringify(t)))}catch(e){return Promise.reject(e)}}},{key:"bind",value:function(){return{getPref:this.getPref.bind(this),setPref:this.setPref.bind(this)}}},{key:"listen",value:function(e,t){var n=this;"function"==typeof e&&(t=e,e=void 0);var r=function(r){if(null===r.key){if(void 0===e)return}else{if(!r.key.startsWith(n.namespace))return;if(void 0!==e&&!r.key.startsWith(n.namespace+e))return}t(r)};return window.addEventListener("storage",r),this.listeners.push(r),r}},{key:"unlisten",value:function(e){if(e)for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return this.listeners.splice(t,1),void window.removeEventListener("storage",e);this.listeners.forEach((function(e){window.removeEventListener("storage",e)}))}}]),e}(),f=function(){function e(n){var r=n.defaults;t(this,e),this.defaults=r}return r(e,[{key:"getPrefDefault",value:function(e){try{return i(this.defaults[e])}catch(e){return Promise.reject(e)}}},{key:"setPrefDefault",value:function(e,t){try{var n=this.defaults[e];return this.defaults[e]=t,i(n)}catch(e){return Promise.reject(e)}}}]),e}();function u(e){return new f({defaults:e})}e.SimplePrefs=s,e.SimplePrefsDefaults=f,e.simplePrefsDefaults=u,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
