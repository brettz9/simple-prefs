!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SimplePrefs={})}(this,function(e){"use strict";function t(e,t,s){return s?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function s(e,t,s){try{var n=Promise.resolve(e());return t?n.then(t):n}catch(e){return Promise.reject(e)}}class n{constructor({defaults:e}){this.defaults=e}getPrefDefault(e){const n=this;return s(function(){return t(n.defaults[e],function(e){return e??null})})}setPrefDefault(e,n){const r=this;return s(function(){const s=r.defaults[e]??null;return r.defaults[e]=n,t(s)})}}function r(e={}){return new n({defaults:e})}e.SimplePrefs=class{constructor(e){this.configurePrefs(e),this.listeners=[]}configurePrefs({namespace:e,defaults:t,prefDefaults:s=r(t)}){this.namespace=e??"",this.prefDefaults=s}getPref(e){const n=this;return s(function(){const s=localStorage.getItem(n.namespace+e);return t(t(null===s?n.prefDefaults.getPrefDefault(e):JSON.parse(s),void 0,!(null===s)))})}setPref(e,n){const r=this;return s(function(){return t(localStorage.setItem(r.namespace+e,JSON.stringify(n)))})}bind(){return{getPref:this.getPref.bind(this),setPref:this.setPref.bind(this)}}listen(e,t){"function"==typeof e&&(t=e,e=void 0);const s=s=>{if(null===s.key){if(void 0===e)return}else{if(!s.key.startsWith(this.namespace))return;if(void 0!==e&&!s.key.startsWith(this.namespace+e))return}t(s)};return globalThis.addEventListener("storage",s),this.listeners.push(s),s}unlisten(e){if(e)for(let t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return this.listeners.splice(t,1),void globalThis.removeEventListener("storage",e);this.listeners.forEach(e=>{globalThis.removeEventListener("storage",e)})}},e.SimplePrefsDefaults=n,e.simplePrefsDefaults=r});
//# sourceMappingURL=index.umd.min.cjs.map
