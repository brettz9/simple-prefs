!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SimplePrefs={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,s=void 0,"symbol"==typeof(s=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"))?s:String(s)),n)}var i,s}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var s=function(){function e(r){t(this,e),this.configurePrefs(r),this.listeners=[]}return n(e,[{key:"configurePrefs",value:function(e){var t=e.namespace,r=e.defaults,n=e.prefDefaults,i=void 0===n?f(r):n;this.namespace=null!=t?t:"",this.prefDefaults=i}},{key:"getPref",value:function(e){try{var t=localStorage.getItem(this.namespace+e);return i(i(null===t?this.prefDefaults.getPrefDefault(e):JSON.parse(t),void 0,!(null===t)))}catch(e){return Promise.reject(e)}}},{key:"setPref",value:function(e,t){try{return i(localStorage.setItem(this.namespace+e,JSON.stringify(t)))}catch(e){return Promise.reject(e)}}},{key:"bind",value:function(){return{getPref:this.getPref.bind(this),setPref:this.setPref.bind(this)}}},{key:"listen",value:function(e,t){var r=this;"function"==typeof e&&(t=e,e=void 0);var n=function(n){if(null===n.key){if(void 0===e)return}else{if(!n.key.startsWith(r.namespace))return;if(void 0!==e&&!n.key.startsWith(r.namespace+e))return}t(n)};return window.addEventListener("storage",n),this.listeners.push(n),n}},{key:"unlisten",value:function(e){if(e)for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return this.listeners.splice(t,1),void window.removeEventListener("storage",e);this.listeners.forEach((function(e){window.removeEventListener("storage",e)}))}}]),e}(),u=function(){function e(r){var n=r.defaults;t(this,e),this.defaults=n}return n(e,[{key:"getPrefDefault",value:function(e){try{return i(this.defaults[e],(function(e){return null!=e?e:null}))}catch(e){return Promise.reject(e)}}},{key:"setPrefDefault",value:function(e,t){try{var r,n=null!==(r=this.defaults[e])&&void 0!==r?r:null;return this.defaults[e]=t,i(n)}catch(e){return Promise.reject(e)}}}]),e}();function f(){return new u({defaults:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}})}e.SimplePrefs=s,e.SimplePrefsDefaults=u,e.simplePrefsDefaults=f}));
//# sourceMappingURL=index.umd.min.cjs.map
